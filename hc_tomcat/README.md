hc_tomcat Cookbook
====================
Description
===========
This cookbook will install apache tomcat **7** and **8** depending on the user requirement. Default is set to ** tomcat 8** version. If any other version need to be installed then user has to override the - `node['hc_tomcat']['base_version']` attribute.

Below is the list of implementations supported by this cookbook.

* cp_phix
* sso

### Platforms
* RHEL
* Ubuntu

### Attributes

### Dependencies

*None

Usage
==
Include hc_tomcat cookbook at your node runlist and overide the default attributes as per the configuration needs. Check out the ``Attributes`` section below to know about attributes and their default values.


### Attributes

- `default['hc_tomcat']['java_home'] = "/usr/java/jdk1.7.0_40"`
- `default['hc_tomcat']['databag_name'] = 'artifact_cred'`
- `default['hc_tomcat']['databag_id'] = 'artifact_cred'`
- `default['hc_users']['users'] = ['tomcat']`
- `default['hc_tomcat']['remove_dirs'] = ['docs','examples','host-manager', 'manager']`
- `default['hc_tomcat']['base_version'] = '8'`
- `if node['hc_tomcat']['base_version'] == '7'`
- `  default['package_url'] = 'http://artifactory.demo.company.com/artifactory/chef-repo/apache-tomcat-7.0.67.tar.gz'`
- `  default['hc_tomcat']['package_name'] = 'apache-tomcat-7.0.67.tar.gz'`
- `  default['hc_tomcat']['tomcat_dir_name'] = 'apache-tomcat-7.0.67'`
- `  default['hc_tomcat']['zip_path'] = '/opt/tomcat7.zip'`
- `else node['hc_tomcat']['base_version']  == '8'`
- `  default['package_url'] = 'http://artifactory.demo.company.com/artifactory/chef-repo/apache-tomcat-8.0.30.tar.gz'`
- `  default['hc_tomcat']['package_name'] = 'apache-tomcat-8.0.30.tar.gz'`
- `  default['hc_tomcat']['tomcat_dir_name'] = 'apache-tomcat-8.0.30'`
- `  default['hc_tomcat']['zip_path'] = '/opt/tomcat8.zip'`
- `end`
- ``
- `default['hc_tomcat']['install_path'] = '/usr/local'`
- `default['hc_tomcat']['symlink'] = 'tomcat'`
- `default['hc_tomcat']['tomcat_home'] = "#{node['hc_tomcat']['install_path']}/#{node['hc_tomcat']['symlink']}"`
- `default['hc_tomcat']['bin_path'] = "#{node['hc_tomcat']['tomcat_home']}/bin"`
- `default['hc_tomcat']['tomcat_user'] = 'tomcat'`
- `default['hc_tomcat']['tomcat_group'] = 'tomcat'`
- `default['hc_tomcat']['admin_user'] = 'admin'`
- `default['hc_tomcat']['base_instance'] = "tomcat#{node['hc_tomcat']['base_version']}"`
- `default['hc_tomcat']['port'] = 8080`
- `default['hc_tomcat']['proxy_port'] = 443`
- `default['hc_tomcat']['proxy_name'] = 'company.com'`
- `default['hc_tomcat']['secure'] = true`
- `default['hc_tomcat']['scheme'] = 'https'`
- `default['hc_tomcat']['max_connections'] = 1500`
- `default['hc_tomcat']['keep_alive_timeout'] = 5000`
- `default['hc_tomcat']['connection_timeout'] = 10000`
- `default['hc_tomcat']['ssl_port'] = 8443`
- `default['hc_tomcat']['ssl_proxy_port'] = nil`
- `default['hc_tomcat']['ajp_port'] = 8009`
- `default['hc_tomcat']['ajp_redirect_port'] = nil`
- `default['hc_tomcat']['shutdown_port'] = 8005`
- `default['hc_tomcat']['catalina_options'] = ''`
- `default['hc_tomcat']['xmsx_percentage'] = '60'`
- `#server.xml properties`
- `default['hc_tomcat']['proxyname'] = ''`
- ``
- `#default['hc_tomcat']['xmsx'] = ''`
- `if node[:hc_tomcat].attribute?(:xmsx)`
- `  default['hc_tomcat']['java_options'] = "-Xms#{node['hc_tomcat']['xmsx']}M -Xmx#{node['hc_tomcat']['xmsx']}M -Djava.awt.headless=true"`
- `else`
- `  default['hc_tomcat']['xmsx'] = (node['memory']['total'][0..-3].to_f / 1024) * (node['hc_tomcat']['xmsx_percentage'].to_f / 100)`
- `  default['hc_tomcat']['java_options'] = "-Xms#{node['hc_tomcat']['xmsx'].to_i}M -Xmx#{node['hc_tomcat']['xmsx'].to_i}M -Djava.awt.headless=true"`
- `end`
- `default['hc_tomcat']['use_security_manager'] = false`
- `default['hc_tomcat']['authbind'] = 'no'`
- `default['hc_tomcat']['deploy_manager_apps'] = true`
- `default['hc_tomcat']['max_threads'] = 600`
- `default['hc_tomcat']['ssl_max_threads'] = 150`
- `default['hc_tomcat']['ssl_cert_file'] = nil`
- `default['hc_tomcat']['ssl_key_file'] = nil`
- `default['hc_tomcat']['ssl_chain_files'] = []`
- `default['hc_tomcat']['ssl_enabled_protocols'] = nil`
- `default['hc_tomcat']['ciphers'] = nil`
- `default['hc_tomcat']['keystore_file'] = 'keystore.jks'`
- `default['hc_tomcat']['keystore_type'] = 'jks'`
- `# The keystore and truststore passwords will be generated by the`
- `# # openssl cookbook's secure_password method in the recipe if they are`
- `# # not otherwise set. Do not hardcode passwords in the cookbook.`
- ` default['hc_tomcat']['keystore_password'] = 'company123'`
- ` default['hc_tomcat']['truststore_password'] = 'company123'`

- `default['hc_tomcat']['truststore_file'] = nil`
- `default['hc_tomcat']['truststore_type'] = 'jks'`
- `default['hc_tomcat']['certificate_dn'] = 'cn=localhost'`
- `default['hc_tomcat']['loglevel'] = 'INFO'`
- `default['hc_tomcat']['tomcat_auth'] = 'true'`
- `default['hc_tomcat']['client_auth'] = 'false'`
- `default['hc_tomcat']['instances'] = {}`
- `default['hc_tomcat']['run_base_instance'] = true`
- `default['hc_tomcat']['environment'] = []`
- `default['hc_tomcat']['packages'] = ["tomcat#{node['hc_tomcat']['base_version']}"]`
- `default['hc_tomcat']['deploy_manager_packages'] = ["tomcat#{node['hc_tomcat']['base_version']}-admin"]`
- `default['hc_tomcat']['ajp_packetsize'] = '8192'`
- `default['hc_tomcat']['uriencoding'] = 'UTF-8'`
- `case node['platform_family']`

- `when 'rhel', 'fedora'`
- `  #suffix = node['hc_tomcat']['base_version'].to_i < 7 ? node['hc_tomcat']['base_version'] : ''`
- `  suffix = node['hc_tomcat']['base_version']`
- ``
- `  default['hc_tomcat']['base_instance'] = "tomcat#{suffix}"`
- `  default['hc_tomcat']['user'] = 'tomcat'`
- `  default['hc_tomcat']['group'] = 'tomcat'`
- `  #default['hc_tomcat']['home'] = "#{node['hc_tomcat']['tomcat_home']}#{suffix}"`
- `  #default['hc_tomcat']['base'] = "#{node['hc_tomcat']['tomcat_home']}#{suffix}"`
- `  default['hc_tomcat']['home'] = "#{node['hc_tomcat']['tomcat_home']}"`
- `  default['hc_tomcat']['base'] = "#{node['hc_tomcat']['tomcat_home']}"`
- `  #default['hc_tomcat']['config_dir'] = "/etc/tomcat#{suffix}"`
- `  default['hc_tomcat']['config_dir'] = "/etc/tomcat"`
- `  default['hc_tomcat']['log_dir'] = "/var/log/tomcat#{suffix}"`
- `  default['hc_tomcat']['tmp_dir'] = "/var/cache/tomcat#{suffix}/temp"`
- `  default['hc_tomcat']['work_dir'] = "/var/cache/tomcat#{suffix}/work"`
- `  default['hc_tomcat']['context_dir'] = "#{node['hc_tomcat']['config_dir']}/Catalina/localhost"`
- `  default['hc_tomcat']['webapp_dir'] = "#{node['hc_tomcat']['tomcat_home']}/webapps"`
- `  default['hc_tomcat']['keytool'] = 'keytool'`
- `  default['hc_tomcat']['lib_dir'] = "#{node['hc_tomcat']['home']}/lib"`
- `  default['hc_tomcat']['endorsed_dir'] = "#{node['hc_tomcat']['lib_dir']}/endorsed"`
- `  default['hc_tomcat']['packages'] = ["tomcat#{suffix}"]`
- `  default['hc_tomcat']['deploy_manager_packages'] = ["tomcat#{suffix}-admin-webapps"]`
- `else`
- `  default['hc_tomcat']['user'] = "tomcat#{node['hc_tomcat']['base_version']}"`
- `  default['hc_tomcat']['group'] = "tomcat#{node['hc_tomcat']['base_version']}"`
- `  default['hc_tomcat']['home'] = "/usr/share/tomcat#{node['hc_tomcat']['base_version']}"`
- `  default['hc_tomcat']['base'] = "/var/lib/tomcat#{node['hc_tomcat']['base_version']}"`
- `  default['hc_tomcat']['config_dir'] = "/etc/tomcat#{node['hc_tomcat']['base_version']}"`
- `  default['hc_tomcat']['log_dir'] = "/var/log/tomcat#{node['hc_tomcat']['base_version']}"`
- `  default['hc_tomcat']['tmp_dir'] = "/tmp/tomcat#{node['hc_tomcat']['base_version']}-tmp"`
- `  default['hc_tomcat']['work_dir'] = "/var/cache/tomcat#{node['hc_tomcat']['base_version']}"`
- `  default['hc_tomcat']['context_dir'] = "#{node['hc_tomcat']['config_dir']}/Catalina/localhost"`
- `  default['hc_tomcat']['webapp_dir'] = "/var/lib/tomcat#{node['hc_tomcat']['base_version']}/webapps"`
- `  default['hc_tomcat']['keytool'] = 'keytool'`
- `  default['hc_tomcat']['lib_dir'] = "#{node['hc_tomcat']['home']}/lib"`
- `  default['hc_tomcat']['endorsed_dir'] = "#{node['hc_tomcat']['lib_dir']}/endorsed"`
- `end`

- `#Properties to be populated in setenv.sh`
- `default['hc_tomcat']['idm']['app_prop'] = '/opt/idm/resources/application.properties'`
- `default['hc_tomcat']['idm']['app_config_prop'] = '/opt/idm/resources/appConfig.properties'`
- `default['hc_tomcat']['idm']['idp_app_tenant_prop'] = '/opt/idm/resources/idpAppTenant.properties'`
- `default['hc_tomcat']['idm']['log4j_prop'] = '/opt/idm/resources/log4j.properties'`
- `default['hc_tomcat']['idm']['resources_path'] = '/opt/idm/resources'`
- `default['hc_tomcat']['idm']['zendesk_app_prop'] = '/opt/idm/resources/zendesk-application.properties'`
- 
References
====
NA

License and Authors
-------------------
Authors: company


TODOS
====
Add a mechanism to use same recipe for all type of install/upgrade

### Foodcritic

FC001 - This rule has been deprecated. See http://www.foodcritic.io/#FC001 for more details.
FC002 - This has to be ignored due to logical dependency.
FC019 - This has to be ignored due to logical dependency.
FC023 - This has to be ignored due to logical dependency.

However, Will look in to alternative approach to to prevent foodcritic warnings



